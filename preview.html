<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Focus</title>
  <style>
    /* ── Variables ── */
    :root {
      --bg: #E8E8E8;
      --card-bg: #fff;
      --text-primary: #111;
      --text-secondary: #444;
      --text-muted: #999;
      --text-faint: #CCC;
      --border: rgba(0,0,0,0.04);
      --border-soft: #EAEAEA;
      --border-input: #E0E0E0;
      --badge-bg: #F5F5F5;
      --badge-color: #999;
      --break-color: #5A8A6A;
      --break-bg: #EBF4EE;
      --gear-bg: rgba(255,255,255,0.75);
      --gear-border: rgba(0,0,0,0.08);
      --gear-color: #999;
      --modal-bg: #fff;
      --overlay-bg: rgba(0,0,0,0.22);
      --toggle-on: #111;
      --toggle-off: #E0E0E0;
      --toggle-knob: #fff;
      --card-shadow: 0 2px 8px rgba(0,0,0,0.06), 0 0 0 1px rgba(0,0,0,0.04);
      --card-shadow-hover: 0 8px 32px rgba(0,0,0,0.10), 0 0 0 1px rgba(0,0,0,0.04);
      --slider-track: #E5E5E5;
      --slider-thumb: #111;
      --caption-color: #666666;
      --divider: #F0F0F0;
    }

    body.dark {
      --bg: #181818;
      --card-bg: #242424;
      --text-primary: #EFEFEF;
      --text-secondary: #BDBDBD;
      --text-muted: #777;
      --text-faint: #484848;
      --border: rgba(255,255,255,0.06);
      --border-soft: #2E2E2E;
      --border-input: #3A3A3A;
      --badge-bg: #2E2E2E;
      --badge-color: #666;
      --gear-bg: rgba(36,36,36,0.9);
      --gear-border: rgba(255,255,255,0.1);
      --gear-color: #666;
      --modal-bg: #242424;
      --overlay-bg: rgba(0,0,0,0.55);
      --toggle-on: #EFEFEF;
      --toggle-off: #333;
      --toggle-knob: #111;
      --card-shadow: 0 2px 8px rgba(0,0,0,0.35), 0 0 0 1px rgba(255,255,255,0.04);
      --card-shadow-hover: 0 8px 32px rgba(0,0,0,0.45), 0 0 0 1px rgba(255,255,255,0.06);
      --slider-track: #333;
      --slider-thumb: #EFEFEF;
      --caption-color: #484848;
      --divider: #2E2E2E;
    }

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'SF Pro Text', sans-serif;
      min-height: 100vh;
      padding: 0 40px 80px;
      -webkit-font-smoothing: antialiased;
      transition: background 0.4s ease;
    }

    /* ── Header ── */
    header {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 52px 0 72px;
      position: relative;
      z-index: 10;
      gap: 8px;
    }
    .site-title {
      font-size: 28px;
      font-weight: 600;
      color: var(--text-primary);
      letter-spacing: -0.6px;
      transition: color 0.4s;
    }
    .back-link {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-faint);
      text-decoration: none;
      cursor: pointer;
      opacity: 0;
      pointer-events: none;
      height: 0;
      overflow: hidden;
      transform: translateY(-4px);
      transition: opacity 0.5s ease, transform 0.5s cubic-bezier(0.34,1.3,0.64,1), color 0.2s, height 0.4s ease;
    }
    .back-link.visible { opacity: 1; pointer-events: auto; height: 20px; transform: translateY(0); }
    .back-link:hover { color: var(--text-secondary); }

    /* ── Grid ── */
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      max-width: 1400px;
      margin: 0 auto;
      align-items: start;
    }

    /* ── Card ── */
    .card {
      width: 100%;
      background: var(--card-bg);
      border-radius: 28px;
      overflow: hidden;
      cursor: pointer;
      box-shadow: var(--card-shadow);
      transition: box-shadow 0.3s ease, transform 0.3s cubic-bezier(0.34,1.3,0.64,1), opacity 0.4s ease, background 0.4s;
      will-change: transform, opacity;
    }
    .card:hover { box-shadow: var(--card-shadow-hover); transform: translateY(-2px); }
    .card:active { transform: scale(0.99); }
    .card.hidden { opacity: 0; transform: scale(0.91) translateY(18px) !important; pointer-events: none; }
    .card.session-card { cursor: default; overflow: visible; }
    .card.session-card:hover { box-shadow: 0 24px 80px rgba(0,0,0,0.2), 0 0 0 1px var(--border); transform: none !important; }

    /* ── Image ── */
    .card-image-wrap {
      margin: 8px 8px 0;
      border-radius: 22px;
      overflow: hidden;
      position: relative;
      height: 520px;
    }
    .card-image-wrap img {
      width: 100%; height: 100%;
      object-fit: cover; display: block;
      transition: transform 0.6s cubic-bezier(0.4,0,0.2,1);
    }
    .card:not(.session-card):hover .card-image-wrap img { transform: scale(1.03); }

    .card-overlay {
      position: absolute; inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.72) 0%, rgba(0,0,0,0.18) 45%, transparent 100%);
      display: flex; align-items: flex-end; justify-content: space-between;
      padding: 20px 20px 22px; gap: 16px;
    }
    .card-label h2 { color: #fff; font-size: 20px; font-weight: 600; letter-spacing: -0.3px; line-height: 1.2; }
    .card-label p  { color: rgba(255,255,255,0.65); font-size: 12px; margin-top: 3px; }

    .start-btn {
      flex-shrink: 0;
      background: rgba(60,60,60,0.55);
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      border: 1px solid rgba(255,255,255,0.18);
      color: #fff; font-size: 14px; font-weight: 500;
      padding: 10px 20px; border-radius: 50px;
      cursor: pointer; white-space: nowrap;
      transition: background 0.2s, transform 0.15s;
    }
    .start-btn:hover { background: rgba(90,90,90,0.72); }
    .start-btn:active { transform: scale(0.96); }

    /* ── Card body ── */
    .card-body { height: 0; overflow: hidden; transition: height 0.52s cubic-bezier(0.4,0,0.2,1); }
    .card-body-inner { padding: 20px 20px 4px; }

    /* ── Stats ── */
    .stats {
      display: flex; margin-bottom: 16px;
      opacity: 0; transform: translateY(8px);
      transition: opacity 0.3s ease 0.08s, transform 0.4s cubic-bezier(0.34,1.3,0.64,1) 0.08s;
    }
    .stat { flex: 1; }
    .stat-value { font-size: 17px; font-weight: 600; color: var(--text-primary); letter-spacing: -0.3px; transition: color 0.4s; }
    .stat-label { font-size: 11px; color: var(--text-muted); margin-top: 3px; text-transform: uppercase; letter-spacing: 0.06em; transition: color 0.4s; }

    .tagline {
      font-size: 13px; color: var(--text-muted); margin-bottom: 18px;
      opacity: 0; transform: translateY(6px);
      transition: opacity 0.3s ease 0.16s, transform 0.4s cubic-bezier(0.34,1.2,0.64,1) 0.16s, color 0.4s;
    }
    .card.open .stats, .card.open .tagline { opacity: 1; transform: translateY(0); }

    /* ── Setup view ── */
    .setup-view { display: none; flex-direction: column; align-items: center; gap: 28px; padding: 28px 16px 8px; }
    .setup-view.active { display: flex; }

    .setup-inputs { display: flex; gap: 48px; justify-content: center; }
    .setup-field  { display: flex; flex-direction: column; align-items: center; gap: 6px; }
    .setup-label  { font-size: 11px; font-weight: 600; color: var(--text-faint); text-transform: uppercase; letter-spacing: 0.08em; transition: color 0.4s; }

    .time-input {
      font-size: 48px; font-weight: 200;
      font-family: 'SF Mono', 'Fira Code', 'Roboto Mono', monospace;
      color: var(--text-primary); width: 96px;
      border: none; border-bottom: 1.5px solid var(--border-input);
      background: transparent; text-align: center; outline: none;
      -moz-appearance: textfield; padding-bottom: 4px;
      transition: border-color 0.2s, color 0.4s;
    }
    .time-input:focus { border-color: var(--text-muted); }
    .time-input::-webkit-inner-spin-button,
    .time-input::-webkit-outer-spin-button { -webkit-appearance: none; }
    .setup-unit { font-size: 12px; color: var(--text-faint); letter-spacing: 0.04em; text-transform: uppercase; transition: color 0.4s; }

    .begin-btn {
      width: 100%; background: var(--text-primary); color: var(--card-bg);
      font-size: 14px; font-weight: 500; padding: 13px;
      border: none; border-radius: 14px; cursor: pointer; margin-bottom: 8px;
      font-family: inherit;
      transition: opacity 0.2s, transform 0.15s, background 0.4s, color 0.4s;
    }
    .begin-btn:hover { opacity: 0.82; }
    .begin-btn:active { transform: scale(0.98); }

    /* ── Timer view ── */
    .timer-view { display: none; flex-direction: column; align-items: center; padding: 24px 20px 8px; gap: 10px; }
    .timer-view.active { display: flex; }

    .phase-badge {
      font-size: 11px; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase;
      color: var(--badge-color); background: var(--badge-bg);
      padding: 4px 14px; border-radius: 50px;
      transition: color 0.5s, background 0.5s;
    }
    .phase-badge.break { color: var(--break-color); background: var(--break-bg); }
    .phase-badge.done  { color: var(--badge-color); background: var(--badge-bg); }

    .timer-digits {
      font-family: 'SF Mono', 'Fira Code', 'Roboto Mono', monospace;
      font-size: 58px; font-weight: 200;
      color: var(--text-primary); letter-spacing: -3px; line-height: 1;
      transition: color 0.5s;
    }
    .timer-digits.break { color: var(--break-color); }
    .timer-digits.done  { color: var(--text-faint); }

    .end-btn {
      margin-top: 6px; margin-bottom: 4px;
      background: none; border: 1px solid var(--border-soft);
      color: var(--text-faint); font-size: 12px; font-weight: 500;
      padding: 7px 20px; border-radius: 50px; cursor: pointer;
      font-family: inherit;
      transition: border-color 0.2s, color 0.2s;
    }
    .end-btn:hover { border-color: var(--text-faint); color: var(--text-secondary); }

    /* ── Gear button ── */
    .gear-btn {
      position: fixed; top: 28px; right: 32px; z-index: 200;
      width: 44px; height: 44px;
      background: var(--gear-bg);
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--gear-border); border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; color: var(--gear-color);
      transition: color 0.2s, background 0.2s, transform 0.3s cubic-bezier(0.34,1.3,0.64,1), border-color 0.4s;
    }
    .gear-btn:hover { color: var(--text-secondary); }
    .gear-btn.open  { transform: rotate(60deg); color: var(--text-primary); }

    /* ── Modal backdrop ── */
    .modal-backdrop {
      position: fixed; inset: 0;
      background: var(--overlay-bg);
      backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
      z-index: 198; opacity: 0; pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .modal-backdrop.open { opacity: 1; pointer-events: auto; }

    /* ── Settings panel ── */
    .settings-panel {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0.94);
      z-index: 199; width: 340px;
      background: var(--modal-bg);
      border-radius: 24px; padding: 28px 24px 24px;
      box-shadow: 0 24px 80px rgba(0,0,0,0.2), 0 0 0 1px var(--border);
      opacity: 0; pointer-events: none;
      transition: opacity 0.3s ease, transform 0.35s cubic-bezier(0.34,1.3,0.64,1), background 0.4s, box-shadow 0.4s;
    }
    .settings-panel.open {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
      pointer-events: auto;
    }

    .settings-heading {
      font-size: 17px; font-weight: 600; color: var(--text-primary);
      letter-spacing: -0.3px; margin-bottom: 4px;
      transition: color 0.4s;
    }
    .settings-desc {
      font-size: 13px; color: var(--text-muted); line-height: 1.5;
      margin-bottom: 24px;
      transition: color 0.4s;
    }

    .settings-section-label {
      font-size: 11px; font-weight: 600; color: var(--text-faint);
      text-transform: uppercase; letter-spacing: 0.08em;
      margin-bottom: 10px; display: block;
      transition: color 0.4s;
    }

    .setting-row {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 16px;
    }
    .setting-row:last-of-type { margin-bottom: 0; }
    .setting-label { font-size: 14px; color: var(--text-secondary); font-weight: 500; transition: color 0.4s; }

    /* ── Toggle ── */
    .toggle-btn {
      width: 40px; height: 22px;
      background: var(--toggle-on); border: none; border-radius: 50px;
      cursor: pointer; position: relative; flex-shrink: 0;
      transition: background 0.25s;
    }
    .toggle-btn::after {
      content: ''; position: absolute; top: 3px; left: 3px;
      width: 16px; height: 16px;
      background: var(--toggle-knob); border-radius: 50%;
      box-shadow: 0 1px 4px rgba(0,0,0,0.2);
      transition: transform 0.25s cubic-bezier(0.34,1.3,0.64,1), background 0.25s;
    }
    .toggle-btn.off { background: var(--toggle-off); }
    .toggle-btn.off::after { transform: translateX(0); }
    .toggle-btn:not(.off)::after { transform: translateX(18px); }

    /* ── Volume slider ── */
    .vol-slider {
      width: 100px; -webkit-appearance: none;
      height: 3px; border-radius: 2px;
      background: var(--slider-track); outline: none; cursor: pointer;
      transition: background 0.4s;
    }
    .vol-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px; height: 14px;
      background: var(--slider-thumb); border-radius: 50%;
      transition: transform 0.15s, background 0.4s;
    }
    .vol-slider::-webkit-slider-thumb:hover { transform: scale(1.2); }

    /* ── Sound picker ── */
    .sound-picker {
      display: flex; background: var(--badge-bg);
      border-radius: 12px; padding: 3px; gap: 2px;
      margin-bottom: 20px; transition: background 0.4s;
    }
    .sound-opt {
      flex: 1; padding: 7px 4px;
      font-size: 12px; font-weight: 500;
      border: none; background: transparent; border-radius: 9px;
      cursor: pointer; color: var(--text-muted); font-family: inherit;
      transition: background 0.2s, color 0.2s;
    }
    .sound-opt.selected {
      background: var(--card-bg); color: var(--text-primary);
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }

    /* ── Divider ── */
    .settings-divider { height: 1px; background: var(--divider); margin: 20px 0; transition: background 0.4s; }

    /* ── Credit ── */
    .settings-credit { font-size: 12px; color: var(--text-faint); text-align: center; transition: color 0.4s; }
    .settings-credit a { color: var(--text-muted); text-decoration: none; font-weight: 500; transition: color 0.2s; }
    .settings-credit a:hover { color: var(--text-secondary); }

    /* ── Card caption ── */
    .card-caption {
      text-align: center; font-size: 17px;
      color: var(--caption-color); font-weight: 600;
      letter-spacing: -0.4px; margin-top: 12px;
      transition: color 0.4s, opacity 0.4s ease;
    }

    /* ── Chevron ── */
    .chevron { display: flex; justify-content: center; padding: 14px 16px 16px; color: var(--text-faint); transition: color 0.4s; }
    .chevron svg { width: 18px; height: 18px; transition: transform 0.45s cubic-bezier(0.34,1.3,0.64,1); }
    .card.open .chevron svg { transform: rotate(180deg); }
    .card.session-card .chevron { display: none; }
  </style>
</head>
<body>

  <!-- Gear -->
  <button class="gear-btn" id="gearBtn" title="Settings">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="3"></circle>
      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
    </svg>
  </button>

  <!-- Modal backdrop -->
  <div class="modal-backdrop" id="modalBackdrop"></div>

  <!-- Settings panel -->
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-heading">Settings</div>
    <p class="settings-desc">Customise your focus experience — sound, style, and rhythm.</p>

    <span class="settings-section-label">Sound</span>
    <div class="setting-row">
      <span class="setting-label">Enable sound</span>
      <button class="toggle-btn" id="soundToggle"></button>
    </div>
    <div class="setting-row">
      <span class="setting-label">Volume</span>
      <input type="range" class="vol-slider" id="volSlider" min="0" max="100" value="80" />
    </div>

    <div class="settings-divider"></div>

    <span class="settings-section-label">Sound style</span>
    <div class="sound-picker">
      <button class="sound-opt selected" data-sound="silver">Silver</button>
      <button class="sound-opt" data-sound="gong">Gong</button>
      <button class="sound-opt" data-sound="chime">Chime</button>
    </div>

    <span class="settings-section-label">Appearance</span>
    <div class="setting-row">
      <span class="setting-label">Dark mode</span>
      <button class="toggle-btn off" id="darkToggle"></button>
    </div>

    <div class="settings-divider"></div>

    <p class="settings-credit">Created by <a href="https://x.com/papa_gorgeous" target="_blank">Alexis Papageorgiou</a></p>
  </div>

  <header>
    <h1 class="site-title">Focus</h1>
    <a class="back-link" id="backLink">← Choose method</a>
  </header>

  <div class="grid" id="grid">

    <!-- ── Card 1: Flowtime ── -->
    <div class="card-wrap">
    <div class="card" data-card="1">
      <div class="card-image-wrap">
        <img src="https://i.pinimg.com/1200x/95/3c/95/953c9586685649165afa7418f1f6e1cb.jpg" alt="Image 1" />
        <div class="card-overlay">
          <div class="card-label">
            <h2>Flowtime</h2>
            <p>Work with your natural rhythm</p>
          </div>
          <button class="start-btn" data-method="flowtime">Start Session</button>
        </div>
      </div>
      <div class="card-body">
        <div class="card-body-inner">
          <div class="stats">
            <div class="stat"><div class="stat-value">Open</div><div class="stat-label">Duration</div></div>
            <div class="stat"><div class="stat-value">You</div><div class="stat-label">Controls Break</div></div>
            <div class="stat"><div class="stat-value">0</div><div class="stat-label">Interruptions</div></div>
          </div>
          <p class="tagline">Work until you stop. Break when it feels right.</p>
          <div class="setup-view" id="setup1">
            <div class="setup-inputs">
              <div class="setup-field">
                <span class="setup-label">Work</span>
                <input type="number" class="time-input" id="workMin" value="25" min="1" max="180" />
                <span class="setup-unit">min</span>
              </div>
              <div class="setup-field">
                <span class="setup-label">Break</span>
                <input type="number" class="time-input" id="breakMin" value="5" min="1" max="60" />
                <span class="setup-unit">min</span>
              </div>
            </div>
            <button class="begin-btn" id="flowtimeBegin">Begin</button>
          </div>
          <div class="timer-view" id="timer1">
            <div class="phase-badge" id="phase1">WORKING</div>
            <div class="timer-digits" id="digits1">—</div>
            <button class="end-btn" data-card="1">End Session</button>
          </div>
        </div>
      </div>
      <div class="chevron">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </div>
    </div>
    <div class="card-caption">Choose your own time</div>
    </div>

    <!-- ── Card 2: 52·17 ── -->
    <div class="card-wrap">
    <div class="card" data-card="2">
      <div class="card-image-wrap">
        <img src="https://i.pinimg.com/736x/90/58/87/905887070068030ccd373611878a17ec.jpg" alt="Image 2" />
        <div class="card-overlay">
          <div class="card-label">
            <h2>52 · 17</h2>
            <p>The productivity sweet spot</p>
          </div>
          <button class="start-btn" data-method="52-17">Start Session</button>
        </div>
      </div>
      <div class="card-body">
        <div class="card-body-inner">
          <div class="stats">
            <div class="stat"><div class="stat-value">52 min</div><div class="stat-label">Work</div></div>
            <div class="stat"><div class="stat-value">17 min</div><div class="stat-label">Break</div></div>
            <div class="stat"><div class="stat-value">Auto</div><div class="stat-label">Switch</div></div>
          </div>
          <p class="tagline">The 52-17 rule is a productivity technique where you work intensely for 52 minutes followed by a 17-minute break to maximize focus and prevent burnout.</p>
          <div class="timer-view" id="timer2">
            <div class="phase-badge" id="phase2">WORKING</div>
            <div class="timer-digits" id="digits2">52:00</div>
            <button class="end-btn" data-card="2">End Session</button>
          </div>
        </div>
      </div>
      <div class="chevron">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </div>
    </div>
    <div class="card-caption">Work Sprint</div>
    </div>

    <!-- ── Card 3: 90 Min ── -->
    <div class="card-wrap">
    <div class="card" data-card="3">
      <div class="card-image-wrap">
        <img src="https://i.pinimg.com/1200x/af/04/33/af0433b3223e8e89c8f89b70ce186c89.jpg" alt="Image 3" />
        <div class="card-overlay">
          <div class="card-label">
            <h2>90 Min Deep Work</h2>
            <p>One block. Full focus.</p>
          </div>
          <button class="start-btn" data-method="90min">Start Session</button>
        </div>
      </div>
      <div class="card-body">
        <div class="card-body-inner">
          <div class="stats">
            <div class="stat"><div class="stat-value">90 min</div><div class="stat-label">Duration</div></div>
            <div class="stat"><div class="stat-value">1–3×</div><div class="stat-label">Per Day</div></div>
            <div class="stat"><div class="stat-value">1 task</div><div class="stat-label">Focus</div></div>
          </div>
          <p class="tagline">Matches your brain's natural 90-min cycle. Sound ends it.</p>
          <div class="timer-view" id="timer3">
            <div class="phase-badge" id="phase3">WORKING</div>
            <div class="timer-digits" id="digits3">90:00</div>
            <button class="end-btn" data-card="3">End Session</button>
          </div>
        </div>
      </div>
      <div class="chevron">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </div>
    </div>
    <div class="card-caption">Deep Work</div>
    </div>

  </div>

  <script>
    // ─── State ────────────────────────────────────────────────────
    let s = { method: null, cardNum: null, phase: 'work', secs: 0, breakSecs: 0, interval: null };

    const settings = { muted: false, volume: 0.8, sound: 'silver' };

    // ─── Sounds ───────────────────────────────────────────────────
    const playSound = () => {
      if (settings.muted) return;
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const now = ctx.currentTime;
      const vol = settings.volume;

      if (settings.sound === 'silver') {
        // Struck silver bell — bright, medium decay
        const revBuf = makeReverb(ctx, 2);
        const conv = ctx.createConvolver(); conv.buffer = revBuf;
        const dryG = ctx.createGain(), wetG = ctx.createGain();
        dryG.gain.value = 0.66 * vol; wetG.gain.value = 0.34 * vol;
        conv.connect(wetG); dryG.connect(ctx.destination); wetG.connect(ctx.destination);

        const bl = Math.floor(ctx.sampleRate * 0.024);
        const sbuf = ctx.createBuffer(1, bl, ctx.sampleRate);
        const sd = sbuf.getChannelData(0);
        for (let i = 0; i < bl; i++) sd[i] = (Math.random()*2-1) * Math.pow(1-i/bl, 3);
        const sn = ctx.createBufferSource(), sg = ctx.createGain();
        sn.buffer = sbuf; sg.gain.setValueAtTime(0.14*vol, now); sg.gain.exponentialRampToValueAtTime(0.0001, now+0.024);
        sn.connect(sg); sg.connect(ctx.destination); sn.start(now);

        [[880,0.52,0.003,4.5],[2420,0.22,0.003,3.2],[4752,0.10,0.004,2.0],[7040,0.04,0.005,1.2]]
          .forEach(([f,a,atk,dec]) => {
            [dryG, conv].forEach(dest => {
              const o = ctx.createOscillator(), g = ctx.createGain();
              o.type = 'sine';
              o.frequency.setValueAtTime(f * 1.007, now);
              o.frequency.exponentialRampToValueAtTime(f, now + 0.06);
              g.gain.setValueAtTime(0, now);
              g.gain.linearRampToValueAtTime(a, now + atk);
              g.gain.exponentialRampToValueAtTime(0.0001, now + dec);
              o.connect(g); g.connect(dest);
              o.start(now); o.stop(now + dec + 0.1);
            });
          });

      } else if (settings.sound === 'gong') {
        // Deep temple gong — low, resonant, long decay
        const revBuf = makeReverb(ctx, 3.5);
        const conv = ctx.createConvolver(); conv.buffer = revBuf;
        const dryG = ctx.createGain(), wetG = ctx.createGain();
        dryG.gain.value = 0.55 * vol; wetG.gain.value = 0.45 * vol;
        conv.connect(wetG); dryG.connect(ctx.destination); wetG.connect(ctx.destination);

        // Thump noise at strike
        const bl = Math.floor(ctx.sampleRate * 0.04);
        const sbuf = ctx.createBuffer(1, bl, ctx.sampleRate);
        const sd = sbuf.getChannelData(0);
        for (let i = 0; i < bl; i++) sd[i] = (Math.random()*2-1) * Math.pow(1-i/bl, 2);
        const sn = ctx.createBufferSource(), sg = ctx.createGain();
        sn.buffer = sbuf; sg.gain.setValueAtTime(0.22*vol, now); sg.gain.exponentialRampToValueAtTime(0.0001, now+0.04);
        sn.connect(sg); sg.connect(ctx.destination); sn.start(now);

        // Inharmonic partials for metallic gong quality
        [[110,0.6,0.01,7.0],[275,0.3,0.008,5.5],[385,0.15,0.006,4.0],[550,0.08,0.005,2.5]]
          .forEach(([f,a,atk,dec]) => {
            [dryG, conv].forEach(dest => {
              const o = ctx.createOscillator(), g = ctx.createGain();
              o.type = 'sine';
              o.frequency.setValueAtTime(f * 1.004, now);
              o.frequency.exponentialRampToValueAtTime(f, now + 0.1);
              g.gain.setValueAtTime(0, now);
              g.gain.linearRampToValueAtTime(a, now + atk);
              g.gain.exponentialRampToValueAtTime(0.0001, now + dec);
              o.connect(g); g.connect(dest);
              o.start(now); o.stop(now + dec + 0.1);
            });
          });

      } else if (settings.sound === 'chime') {
        // Light wind chime — airy, clear, quick
        const revBuf = makeReverb(ctx, 1.2);
        const conv = ctx.createConvolver(); conv.buffer = revBuf;
        const dryG = ctx.createGain(), wetG = ctx.createGain();
        dryG.gain.value = 0.6 * vol; wetG.gain.value = 0.4 * vol;
        conv.connect(wetG); dryG.connect(ctx.destination); wetG.connect(ctx.destination);

        // Two chime notes slightly offset for natural feel
        [[1320,0.45,0.002,2.2],[1760,0.28,0.002,1.8],[2640,0.12,0.003,1.2]]
          .forEach(([f,a,atk,dec], i) => {
            [dryG, conv].forEach(dest => {
              const o = ctx.createOscillator(), g = ctx.createGain();
              o.type = 'sine';
              const t = now + i * 0.07;
              o.frequency.setValueAtTime(f, t);
              g.gain.setValueAtTime(0, t);
              g.gain.linearRampToValueAtTime(a, t + atk);
              g.gain.exponentialRampToValueAtTime(0.0001, t + dec);
              o.connect(g); g.connect(dest);
              o.start(t); o.stop(t + dec + 0.1);
            });
          });
      }
    };

    const makeReverb = (ctx, duration) => {
      const len = Math.floor(ctx.sampleRate * duration);
      const buf = ctx.createBuffer(2, len, ctx.sampleRate);
      for (let ch = 0; ch < 2; ch++) {
        const d = buf.getChannelData(ch);
        for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * Math.pow(1-i/len, 2.4);
      }
      return buf;
    };

    // ─── Helpers ──────────────────────────────────────────────────
    const fmt = secs => {
      const m = Math.floor(Math.abs(secs) / 60);
      const sc = Math.abs(secs) % 60;
      return `${String(m).padStart(2,'0')}:${String(sc).padStart(2,'0')}`;
    };

    const updateTab = () => {
      if (!s.method) { document.title = 'Focus'; return; }
      if (s.phase === 'done') { document.title = 'Done · Focus'; return; }
      const prefix = s.phase === 'break' ? 'Break ' : '';
      document.title = `${prefix}${fmt(s.secs)} · Focus`;
    };

    // ─── Settings panel ───────────────────────────────────────────
    const gearBtn       = document.getElementById('gearBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const soundToggle   = document.getElementById('soundToggle');
    const darkToggle    = document.getElementById('darkToggle');
    const volSlider     = document.getElementById('volSlider');
    const soundOpts     = document.querySelectorAll('.sound-opt');

    const openSettings = () => {
      settingsPanel.classList.add('open');
      modalBackdrop.classList.add('open');
      gearBtn.classList.add('open');
    };
    const closeSettings = () => {
      settingsPanel.classList.remove('open');
      modalBackdrop.classList.remove('open');
      gearBtn.classList.remove('open');
    };

    gearBtn.addEventListener('click', e => {
      e.stopPropagation();
      settingsPanel.classList.contains('open') ? closeSettings() : openSettings();
    });
    modalBackdrop.addEventListener('click', closeSettings);

    soundToggle.addEventListener('click', () => {
      settings.muted = !settings.muted;
      soundToggle.classList.toggle('off', settings.muted);
    });

    darkToggle.addEventListener('click', () => {
      const isDark = document.body.classList.toggle('dark');
      darkToggle.classList.toggle('off', !isDark);
    });

    volSlider.addEventListener('input', () => { settings.volume = volSlider.value / 100; });

    soundOpts.forEach(opt => {
      opt.addEventListener('click', () => {
        soundOpts.forEach(o => o.classList.remove('selected'));
        opt.classList.add('selected');
        settings.sound = opt.dataset.sound;
        playSound(); // preview
      });
    });

    // ─── Center Card (FLIP) ───────────────────────────────────────
    const centerCard = card => new Promise(resolve => {
      const r  = card.getBoundingClientRect();
      const tw = Math.min(480, window.innerWidth - 80);
      const tl = (window.innerWidth - tw) / 2;
      const tt = 148;

      card.style.position   = 'fixed';
      card.style.left       = r.left  + 'px';
      card.style.top        = r.top   + 'px';
      card.style.width      = r.width + 'px';
      card.style.zIndex     = '100';
      card.style.margin     = '0';
      card.style.transition = 'none';

      card.getBoundingClientRect();

      requestAnimationFrame(() => {
        card.style.transition = [
          'left 0.68s cubic-bezier(0.4,0,0.2,1)',
          'top  0.68s cubic-bezier(0.4,0,0.2,1)',
          'width 0.68s cubic-bezier(0.4,0,0.2,1)',
          'box-shadow 0.68s ease'
        ].join(', ');
        card.style.left      = tl + 'px';
        card.style.top       = tt + 'px';
        card.style.width     = tw + 'px';
        card.style.boxShadow = '0 28px 90px rgba(0,0,0,0.18), 0 0 0 1px rgba(0,0,0,0.06)';
      });

      setTimeout(resolve, 720);
    });

    // ─── Open card body ───────────────────────────────────────────
    const openBody = card => {
      const body  = card.querySelector('.card-body');
      const inner = card.querySelector('.card-body-inner');
      body.style.transition = 'height 0.48s cubic-bezier(0.4,0,0.2,1)';
      body.style.height = inner.offsetHeight + 'px';
      card.classList.add('open');
      body.addEventListener('transitionend', () => { body.style.height = 'auto'; }, { once: true });
    };

    // ─── Display update ───────────────────────────────────────────
    const updateDisplay = () => {
      const n = s.cardNum;
      const digits = document.getElementById('digits' + n);
      const badge  = document.getElementById('phase'  + n);
      if (!digits || !badge) return;
      if (s.phase === 'done') {
        badge.textContent = 'DONE';    badge.className = 'phase-badge done';
        digits.textContent = '—';      digits.className = 'timer-digits done';
      } else if (s.phase === 'break') {
        badge.textContent = 'BREAK';   badge.className = 'phase-badge break';
        digits.textContent = fmt(s.secs); digits.className = 'timer-digits break';
      } else {
        badge.textContent = 'WORKING'; badge.className = 'phase-badge';
        digits.textContent = fmt(s.secs); digits.className = 'timer-digits';
      }
    };

    // ─── Phase end logic ──────────────────────────────────────────
    const onWorkEnd = () => {
      clearInterval(s.interval);
      playSound();
      if (s.method === '90min') {
        s.phase = 'done'; updateDisplay(); document.title = 'Done · Focus'; return;
      }
      s.phase = 'break'; s.secs = s.breakSecs;
      updateDisplay(); updateTab();
      s.interval = setInterval(tickBreak, 1000);
    };

    const onBreakEnd = () => {
      clearInterval(s.interval);
      playSound();
      if (s.method === '52-17') {
        s.phase = 'work'; s.secs = 52 * 60;
        updateDisplay(); updateTab();
        s.interval = setInterval(tickWork, 1000);
      } else {
        s.phase = 'done'; updateDisplay(); document.title = 'Done · Focus';
      }
    };

    const tickWork = () => {
      s.secs--;
      if (s.secs <= 0) { s.secs = 0; updateDisplay(); updateTab(); onWorkEnd(); return; }
      updateDisplay(); updateTab();
    };

    const tickBreak = () => {
      s.secs--;
      if (s.secs <= 0) { s.secs = 0; updateDisplay(); updateTab(); onBreakEnd(); return; }
      updateDisplay(); updateTab();
    };

    // ─── Launch session ───────────────────────────────────────────
    const launchSession = async (method, card) => {
      window.scrollTo({ top: 0, behavior: 'instant' });
      s.method = method; s.cardNum = card.dataset.card; s.phase = 'work';
      card.classList.add('session-card');

      document.querySelectorAll('.card').forEach((c, i) => {
        if (c === card) return;
        const delay = i * 60;
        setTimeout(() => {
          c.style.transition = `opacity 0.4s ease, transform 0.45s cubic-bezier(0.4,0,0.2,1)`;
          c.classList.add('hidden');
          setTimeout(() => { c.style.visibility = 'hidden'; }, 460);
        }, delay);
      });

      // Hide all captions
      document.querySelectorAll('.card-caption').forEach(cap => {
        cap.style.opacity = '0';
        setTimeout(() => { cap.style.visibility = 'hidden'; }, 420);
      });

      await centerCard(card);
      document.getElementById('backLink').classList.add('visible');
      card.querySelector('.stats').style.display   = 'none';
      card.querySelector('.tagline').style.display = 'none';

      if (method === 'flowtime') {
        document.getElementById('setup1').classList.add('active');
        openBody(card);
      } else {
        s.secs      = method === '52-17' ? 52 * 60 : 90 * 60;
        s.breakSecs = method === '52-17' ? 17 * 60 : 0;
        document.getElementById('timer' + s.cardNum).classList.add('active');
        openBody(card);
        updateDisplay(); updateTab();
        s.interval = setInterval(tickWork, 1000);
      }
    };

    // ─── Flowtime begin ───────────────────────────────────────────
    document.getElementById('flowtimeBegin').addEventListener('click', e => {
      e.stopPropagation();
      const work = Math.max(1, parseInt(document.getElementById('workMin').value)  || 25);
      const brk  = Math.max(1, parseInt(document.getElementById('breakMin').value) || 5);
      s.secs = work * 60; s.breakSecs = brk * 60;

      document.getElementById('setup1').classList.remove('active');
      document.getElementById('timer1').classList.add('active');

      const card  = document.querySelector('[data-card="1"]');
      const body  = card.querySelector('.card-body');
      const inner = card.querySelector('.card-body-inner');
      body.style.transition = 'height 0.38s cubic-bezier(0.4,0,0.2,1)';
      body.style.height = inner.offsetHeight + 'px';
      body.addEventListener('transitionend', () => { body.style.height = 'auto'; }, { once: true });

      updateDisplay(); updateTab();
      s.interval = setInterval(tickWork, 1000);
    });

    // ─── Reset ────────────────────────────────────────────────────
    const resetSession = () => {
      clearInterval(s.interval);
      s = { method: null, cardNum: null, phase: 'work', secs: 0, breakSecs: 0, interval: null };
      document.title = 'Focus';
      document.getElementById('backLink').classList.remove('visible');

      document.querySelectorAll('.card').forEach((card, i) => {
        ['position','left','top','width','zIndex','margin','transition','boxShadow','opacity','transform','visibility']
          .forEach(p => { card.style[p] = ''; });

        card.classList.remove('hidden', 'session-card', 'open');
        card.querySelector('.card-body').style.height = '0';
        card.querySelector('.stats').style.display    = '';
        card.querySelector('.tagline').style.display  = '';
        card.querySelectorAll('.timer-view, .setup-view').forEach(v => v.classList.remove('active'));

        const n = card.dataset.card;
        const badge  = document.getElementById('phase'  + n);
        const digits = document.getElementById('digits' + n);
        if (badge)  { badge.textContent = 'WORKING'; badge.className = 'phase-badge'; }
        if (digits) {
          digits.className   = 'timer-digits';
          digits.textContent = n === '2' ? '52:00' : n === '3' ? '90:00' : '—';
        }

        card.style.opacity   = '0';
        card.style.transform = 'scale(0.92) translateY(16px)';
        setTimeout(() => {
          card.style.transition = `opacity 0.45s ease, transform 0.5s cubic-bezier(0.34,1.3,0.64,1), box-shadow 0.3s ease`;
          card.style.opacity    = '1';
          card.style.transform  = 'none';
        }, 60 + i * 80);
      });

      // Restore captions
      document.querySelectorAll('.card-caption').forEach((cap, i) => {
        cap.style.visibility = '';
        setTimeout(() => { cap.style.opacity = '1'; }, 100 + i * 80);
      });
    };

    // ─── Card tap ─────────────────────────────────────────────────
    document.querySelectorAll('.card').forEach(card => {
      card.addEventListener('click', e => {
        if (e.target.closest('.start-btn,.end-btn,.begin-btn,.time-input')) return;
        if (card.classList.contains('session-card')) return;

        const body  = card.querySelector('.card-body');
        const inner = card.querySelector('.card-body-inner');
        const isOpen = card.classList.contains('open');
        if (isOpen) {
          body.style.height = body.scrollHeight + 'px';
          requestAnimationFrame(() => requestAnimationFrame(() => { body.style.height = '0'; }));
          card.classList.remove('open');
        } else {
          body.style.height = inner.offsetHeight + 'px';
          card.classList.add('open');
          body.addEventListener('transitionend', () => {
            if (card.classList.contains('open')) body.style.height = 'auto';
          }, { once: true });
        }
      });
    });

    // ─── Start / End buttons ──────────────────────────────────────
    document.querySelectorAll('.start-btn').forEach(btn => {
      btn.addEventListener('click', e => { e.stopPropagation(); launchSession(btn.dataset.method, btn.closest('.card')); });
    });
    document.querySelectorAll('.end-btn').forEach(btn => {
      btn.addEventListener('click', e => { e.stopPropagation(); resetSession(); });
    });
    document.getElementById('backLink').addEventListener('click', () => location.reload());
  </script>

</body>
</html>
